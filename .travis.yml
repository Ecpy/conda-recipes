language: generic

env:
  global:
    secure: "eEqhuLsrcqj3A0ydCpJz4fH1fhwLkuTNmGWUlSTfkba2YTmZSeCJ4q006vKmFo3dUMTyI2m59YnSU7qvjov3/kX2T/Ys86sH4q/DRV19smNcbQwNm2YGbE9aKTfKSthoAJ/+hsB3mkio6oZRnAy+nxs8IA35XysqlqtIH6yLNkwBVNbL0kcFbJQ9WiZn0g5vja1O9KT81jOaI1mBwSAlx+50t9StUwUhOKk7paRJs2TF8KkcpHZGozKi4/+jurvuLYyJoZ2wGLYRYuHYu6Cm1pc5hpEAMFk8TjrqGMdJ0oKkDH6k/rAgB6AiBGeNb3FnvGi8U15t/X4yvtLCY7APezWbxT9mlta8KPNPg4PLyl34wUtTZSwj6bKuw4lYt8P/ItKcm0amcT3+LxVKU5zL4KBCtNF+g/RIop+6j+f6HUF4FGdpzS6ZE5GZrS9SQ00XC4THYZAUGsBbylTWoTnlFGB9ZFrgyTEdAlDkJOHCQMPXp1/TIocpuNbdwbqDI4BXn3LO4RmOWdtNbcf4AUZNqUG7IlRvc8Gimu+j8bpMVjGdJsC+5EL4uawkWGoMSmh0Pfwbei0OvNz9CbZaM59PonAxIPuXvxKIIBo5I2tu7m6f31UGWRg61VSRmWR+pYZiJmpIKsxXTkLUllUPOi55aE+JKwt8f1uCAg5j+5qCd2k="

matrix:
  include:
    - os: linux
      dist: trusty
      sudo: false
      env: python=2.7 CONDA_PY=27
    - os: linux
      dist: trusty
      sudo: false
      env: python=3.4 CONDA_PY=34
    - os: linux
      dist: trusty
      sudo: false
      env: python=3.5 CONDA_PY=35
    - os: osx
      osx_image: xcode7.3
      env: CONDA_PY=27
    - os: osx
      osx_image: xcode7.3
      env: CONDA_PY=34
    - os: osx
      osx_image: xcode7.3
      env: CONDA_PY=35

before_install:
  - export TRAVIS_COMMIT_MSG="$(git log --format=%B --no-merges -n 1)"
  - echo $TRAVIS_COMMIT_MSG
  - echo "$TRAVIS_COMMIT_MSG" | grep '\[argh\]'; export BUILD_ARGH=$?; true
  - echo "$TRAVIS_COMMIT_MSG" | grep '\[pathtools\]'; export BUILD_PATHTOOLS=$?; true
  - echo "$TRAVIS_COMMIT_MSG" | grep '\[watchdog\]'; export BUILD_WATCHDOG=$?; true
  - echo "$TRAVIS_COMMIT_MSG" | grep '\[atom\]'; export BUILD_ATOM=$?; true
  - echo "$TRAVIS_COMMIT_MSG" | grep '\[kiwisolver\]'; export BUILD_KIWISOLVER=$?; true
  - echo "$TRAVIS_COMMIT_MSG" | grep '\[enaml\]'; export BUILD_ENAML=$?; true
  - echo "argh" $BUILD_ARGH "pathtools" $BUILD_PATHTOOLS "watchdog" $BUILD_WATCHDOG
  - echo "atom" $BUILD_ATOM "kiwi" $BUILD_KIWISOLVER "enaml" $BUILD_ENAML


install:
  - source continuous-integration/travis/install.sh
  - mkdir conda-bld-out
  - cd conda-bld-out
  - export CONDA_BLD_PATH=$(pwd)
  - cd ..
  - conda config --add channels ecpy

script:
  - source continuous-integration/travis/build-packages.sh

after_success:
  - cd conda-bld-out
  - if [ TRAVIS_SECURE_ENV_VARS ]; then python ../continuous-integration/anaconda-push.py; fi
